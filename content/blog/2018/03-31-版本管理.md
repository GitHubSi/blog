---
title: 版本管理工具

date: 2018-03-30

categories: summarize

tags: [2018]

author: 付辉

---

反思之前的过程，一直没有试图跟上技术的发展。恍然觉得，其实技术比买股票更能让我找到快乐。新的技术越来越多，只能保持蜗牛锲而不舍的精神慢慢爬。

首先感谢这篇文章[2018 年了，你还是只会 npm install 吗？](http://mp.weixin.qq.com/s/3FOWBdErX0Xl3uGoyuzI8g)，让我重新开始审视包管理工具。因为在`PHP`开发中有[Composer](https://getcomposer.org/)，在`Go`的开发中有[glide](https://github.com/Masterminds/glide)。但确实没有认真的去思考它们背后的那些为什么。

## npm包管理

我其实一直不理解`package.json`和`package-lock.json`这两个文件的作用。直观上看，前者是我们项目所依赖的包，后者是各个包自身的明细依赖。但这样的设计却是经过版本迭代最终确定的形式。

当我们执行`install`或者`update`的时候，`package-lock.json`会根据`nodemodules`的更新进行相应更新。**但有时候，我其实会手动的修改`package.json`文件，将别人下载好的依赖拷贝到我的目录下(不知道为啥下载不下来)。这个时候应该执行`install`还是`update`，我忘记啦，后面调查调查。**

### 包的版本

版本号使用`semver`约束。其约定一个包的版本号必须包含3个数字，格式必须为 MAJOR.MINOR.PATCH, 意为 主版本号.小版本号.修订版本号。

还有就是主版本号相同的升级小版本必须提供向下兼容，但也仅仅是口头约束而已。提供了测试版本的网址：[https://semver.npmjs.com/](https://semver.npmjs.com/)

- ^开头的版本：当前主版本下的大于等于小版本号的所有版本
- ~开头的版本：当前主版本、小版本号下的的大于等于修正版本的版本
- *或者x的版本：两者表示通配符
- 在常规仅包含数字的版本号之外：表示不稳定的发布版本

### 管理依赖

有时候，项目和项目之间存在引用关系。比如将项目中共有的类在`common`项目下维护，然后其他项目`project-1`和`project-2`分别引用项目`common`。当`project`项目变得越来越多时，每次新的项目都需要手动拷贝`common`代码。

可以将`common`做为一个包来管理。创建`package.json`文件，将`common`项目托管到git仓库。执行`npm install git_url`就可以将common作为依赖包进行安装了。

npm除了安装git仓库的代码，也可以安装本地的代码。
```bash
npm install file:local-package-path
```

### 版本管理

svn或者git只需要提交`package.json`, `package-lock.json`, 不要提交`node_modules`目录。

每次升级或降级版本，执行如下代码，相应的`package.json`，`package-lock.json`会自动更新：
```
npm install <package-name>@<version>
```

删除依赖包：
```
npm uninstall <package>
```




