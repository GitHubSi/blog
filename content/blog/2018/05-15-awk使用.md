---
title: awk使用

date: 2018-05-15

categories: summarize

tags: [2018]

author: 付辉

---

从掌握`awk`的基本指令，到在工作中熟练使用，中间还有一段路要走！通过总结一些工作中需要的案例，来加深理解。

## 打印符合条件的前一行记录

这个案例很抽象，可能非常难遇到，除非自己给自己挖坑。

业务代码中处理每条数据，都会顺序输出两条日志。第一条表示要处理的数据内容，第二条表示处理的结果。现在想滤出来所有处理成功的记录。比如日志文件如下：
```
uid=1
HAPPY
uid=2
SAD
uid=3
SAD
```

处理的`AWK`脚本如下：
```
#! /bin/bash

# testPage表示日志文件
pieces=$(awk '/HAPPY/{line=NR-1;print line}' testPage | xargs) 
for piece in $pieces
do
    echo $(awk NR==$piece testPage)
done
```

脚本总结：

1. 首先通过`正则表达式`过滤，获取执行成功的数据行号。然后传递给`xargs`，转换为空格分隔的字符串。
2. 遍历每个行号。值得注意，`shell`中对空格分隔的字符串可以直接使用`for...in`
3. 通过`awk`条件判断，打印该行内容